-- PREPARATORY DATA ANALYSIS 
-- Complementary query about genres 
-- to get the number of ratings by genre.

-- Let's create a temporary table with number of ratings by genre. 

DROP TABLE IF EXISTS ratings_by_genre;

SELECT 
	SUM(m.action) AS "Action",  
	SUM(m.adventure) AS "Adventure",  
	SUM(m.animation) AS "Animation",  
	SUM(m.children) AS "Children",  
	SUM(m.comedy) AS "Comedy",  
	SUM(m.crime) AS "Crime",  
	SUM(m.documentary) AS "Documentary",  
	SUM(m.drama) AS "Drama",  
	SUM(m.fantasy) AS "Fantasy",  
	SUM(m.film_noir) AS "Film Noir",  
	SUM(m.horror) AS "Horror",  
	SUM(m.IMAX) AS "IMAX",  
	SUM(m.musical) AS "Musical",  
	SUM(m.mystery) AS "Mystery",  
	SUM(m.romance) AS "Romance",  
	SUM(m.sci_fi) AS "Sci-Fi",  
	SUM(m.thriller) AS "Thriller",  
	SUM(m.war) AS "War",  
	SUM(m.western) AS "Western",
	COUNT(r.rating_id) AS "All Genres Aggregated (<>sum)"
INTO
	TEMP TABLE ratings_by_genre
FROM
    ratings AS r,
	movies AS m
WHERE
    r.movie_id = m.movie_id
; 

-- Let's convert the temporary table into a CSV file in local.
-- (The file will also be copied to the repository, as all other files.)

COPY 
	(SELECT * FROM ratings_by_genre)
TO 
	'E:\14_Data_Science_SQL\10_Cohort_Analysis\17_preparatory_analysis_results_from_SQL_rating_count_by_genre.csv'
WITH 
	(FORMAT CSV, HEADER)
;

-- This CSV file will be used to draw a graph in Excel.